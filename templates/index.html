<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Instagram Downloader</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <style>
            body {
                font-family: "Arial", sans-serif;
                background-color: #f4f4f4;
                margin: 0;
                padding: 0;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                height: 100vh;
            }

            h1 {
                text-align: center;
                color: gray;
            }

            form {
                text-align: center;
                margin-top: 20px;
            }

            label {
                display: block;
                margin-bottom: 5px;
                color: gray;
            }

            input,
            textarea {
                width: 100%;
                padding: 8px;
                margin-bottom: 15px;
                box-sizing: border-box;
                border: 1px solid #ccc;
                border-radius: 4px;
                background-color: #fff;
            }

            .button {
                background-color: gray;
                color: #fff;
                border: none;
                padding: 10px 20px;
                text-align: center;
                text-decoration: none;
                display: inline-block;
                font-size: 16px;
                border-radius: 4px;
                cursor: pointer;
                transition: background-color 0.3s ease;
            }

            .button:hover {
                background-color: #555;
            }

            .button:active {
                scale: 0.95;
                background-color: #444;
            }

            #video-container {
                text-align: center;
                margin-top: 20px;
            }

            p {
                text-align: center;
                color: #555;
            }
            ::-webkit-scrollbar {
                width: 10px;
            }
            ::-webkit-scrollbar-track {
                background: white;
            }
            ::-webkit-scrollbar-thumb {
                background: lightgray;
            }
            ::-webkit-scrollbar-thumb:hover {
                background: darkgray;
            }
            #progress-container {
                display: flex;
                align-items: center;
                justify-content: center;
                margin-top: 20px;
            }
            #download-progress {
                height: 30px;
            }
            #progress-text {
                color: gray;
                font-size: 20px;
                margin-top: 2px;
                position: absolute;
            }
        </style>
        <script>
            $(document).ready(function () {
                $("#download-form").on("submit", function (e) {
                    e.preventDefault();

                    var username = $("#username").val();
                    var password = $("#password").val();
                    var post_urls = $("#post_urls").val();

                    // Show progress indication
                    $("#progress-container").show();

                    $.ajax({
                        url: "/download",
                        method: "POST",
                        data: {
                            username: username,
                            password: password,
                            post_urls: post_urls,
                        },
                        xhr: function () {
                            var xhr = new window.XMLHttpRequest();
                            // Upload progress
                            xhr.upload.addEventListener(
                                "progress",
                                function (evt) {
                                    if (evt.lengthComputable) {
                                        var percentComplete =
                                            evt.loaded / evt.total;
                                        // Update progress bar
                                        $("#download-progress").css(
                                            "width",
                                            percentComplete * 100 + "%"
                                        );
                                        // Update progress text
                                        $("#progress-text").text(
                                            Math.round(percentComplete * 100) +
                                                "%"
                                        );
                                    }
                                },
                                false
                            );
                            return xhr;
                        },
                        success: function (data) {
                            window.location.href = "{{ url_for('download') }}?file=downloaded_files";
                        },
                        error: function () {
                            alert("An error occurred. Please try again.");
                        },
                    });
                });

                // Handler for clear button
                $("#clear-button").on("click", function () {
                    $.ajax({
                        url: "/clear",
                        method: "POST",
                        success: function (data) {
                            alert("Cleared successfully."); // Alert on successful clear
                        },
                        error: function () {
                            alert("An error occurred. Please try again.");
                        },
                    });
                });
            });
        </script>
    </head>
    <body>
        <h1>Bulk Instagram Downloader</h1>
        <p>Login is optional and isn't required for most cases!</p>
        <form method="post" id="download-form">
            <label for="username">Username:</label>
            <input type="text" id="username" name="username" />

            <label for="password">Password:</label>
            <input type="password" id="password" name="password" />

            <label for="post_urls">Post URLs (one per line):</label>
            <textarea
                id="post_urls"
                name="post_urls"
                rows="4"
                cols="50"
            ></textarea>

            <button class="button" type="submit">Download</button>
        </form>
        <div id="progress-container" style="display: none">
            <div id="download-progress"></div>
            <div id="progress-text">0%</div>
        </div>
        <div id="video-container"></div>
    </body>
</html>
